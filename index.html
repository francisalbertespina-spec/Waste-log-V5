<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>HDJV Waste Management System (WMS)</title>
  <link rel="icon" type="image/png" href="logo.png">
  <link href="style.css" rel="stylesheet" type="text/css"> 
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
  
<body>
  <div class="app-container">
    <div class="header">
      <img src="logo.png" alt="Logo" class="logo" onerror="this.style.display='none'">
      <h1>Waste Management System (WMS)</h1>
      <p>HDJV Environmental Management</p>
      <div id="user-info" class="user-info" style="display: none;">
        <div class="user-badge">
          <span id="user-name"></span>
          <span id="user-role-badge" class="role-badge"></span>
        </div>
        
        <!-- Admin Mode Toggle (visible only to admins) -->
        <div id="mode-toggle" class="mode-toggle admin-only" style="display: none;">
          <span class="mode-label" id="mode-label-user">User</span>
          <label class="toggle-switch">
            <input type="checkbox" id="admin-mode-toggle" onchange="toggleAdminMode()">
            <span class="toggle-slider"></span>
          </label>
          <span class="mode-label" id="mode-label-admin">Admin</span>
        </div>
      </div>
    </div>

    <div class="content">
      <!-- Login Section -->
      <div id="login-section" class="section active">
        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">Welcome</h2>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
          Please sign in with your authorized Google account to continue
        </p>
        
        <div id="loginWrapper">
          <div id="buttonDiv" style="display:flex; justify-content:center;"></div>
        
          <div id="loginLoadingUI" class="login-loading-ui">
            <div class="login-spinner"></div>
            <p>Signing you in‚Ä¶</p>
          </div>
        </div>
      </div>
      
      <!-- Package Selection -->
      <div id="package-section" class="section">
        <h2 style="margin-bottom: 10px; color: #333;">Select Package</h2>
        <p style="color: #666; margin-bottom: 20px;">Choose the package you want to work with</p>
        
        <div class="package-grid">
          <div class="package-card" onclick="selectPackage('P4', this)">
            <div class="icon">üì¶</div>
            <div class="name">Package 4</div>
          </div>
          <div class="package-card" onclick="selectPackage('P5', this)">
            <div class="icon">üì¶</div>
            <div class="name">Package 5</div>
          </div>
          <div class="package-card" onclick="selectPackage('P6', this)">
            <div class="icon">üì¶</div>
            <div class="name">Package 6</div>
          </div>
        </div>

        <button class="btn btn-primary" onclick="confirmPackage()">
          Continue
        </button>
        
        <button class="btn btn-secondary" onclick="logout()" style="margin-top: 10px;">
          Sign Out
        </button>
      </div>

      <!-- NEW: Waste Type Selection -->
      <div id="waste-type-section" class="section">
        <button class="back-btn" onclick="backToPackage()">
          ‚Üê Back to Packages
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active" id="waste-type-package"></span>
        </div>
      
        <h2 style="margin-bottom: 10px; color: #333;">Select Waste Type</h2>
        <p style="color: #666; margin-bottom: 25px;">Choose the type of waste to manage</p>
      
        <div class="menu-grid">
          <div class="menu-btn" onclick="selectWasteType('hazardous')">
            <div class="icon">‚ò¢Ô∏è</div>
            <div class="text">
              <h3>Hazardous Waste</h3>
              <p>Chemical, toxic, and hazardous materials</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
      
          <div class="menu-btn" onclick="selectWasteType('solid')">
            <div class="icon">üóëÔ∏è</div>
            <div class="text">
              <h3>Solid Waste</h3>
              <p>Residual and scrap materials</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
        </div>
        
        <button class="btn btn-secondary" onclick="backToPackage()" style="margin-top: 20px;">
          Change Package
        </button>
      </div>

      <!-- Hazardous Waste Menu Section -->
      <div id="hazardous-menu-section" class="section">
        <button class="back-btn" onclick="backToWasteType()">
          ‚Üê Back to Waste Type
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToWasteType()" id="hazardous-menu-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">Hazardous Waste</span>
        </div>
      
        <h2 style="margin-bottom: 10px; color: #333;">Hazardous Waste</h2>
        <p style="color: #666; margin-bottom: 25px;">What would you like to do?</p>
      
        <div class="menu-grid">
          <div class="menu-btn" onclick="showLogForm('hazardous')">
            <div class="icon">‚úèÔ∏è</div>
            <div class="text">
              <h3>Log New Entry</h3>
              <p>Record new waste disposal</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
      
          <div class="menu-btn" onclick="showHistoryView('hazardous')">
            <div class="icon">üìä</div>
            <div class="text">
              <h3>View Records</h3>
              <p>Browse past entries</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
        </div>
        
        <button class="btn btn-secondary" onclick="backToWasteType()" style="margin-top: 20px;">
          Back
        </button>
      </div>

      <!-- Solid Waste Menu Section (NEW) -->
      <div id="solid-menu-section" class="section">
        <button class="back-btn" onclick="backToWasteType()">
          ‚Üê Back to Waste Type
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToWasteType()" id="solid-menu-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">Solid Waste</span>
        </div>
      
        <h2 style="margin-bottom: 10px; color: #333;">Solid Waste</h2>
        <p style="color: #666; margin-bottom: 25px;">What would you like to do?</p>
      
        <div class="menu-grid">
          <div class="menu-btn" onclick="showLogForm('solid')">
            <div class="icon">‚úèÔ∏è</div>
            <div class="text">
              <h3>Log New Entry</h3>
              <p>Record new waste disposal</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
      
          <div class="menu-btn" onclick="showHistoryView('solid')">
            <div class="icon">üìä</div>
            <div class="text">
              <h3>View Records</h3>
              <p>Browse past entries</p>
            </div>
            <div class="arrow">‚Üí</div>
          </div>
        </div>
        
        <button class="btn btn-secondary" onclick="backToWasteType()" style="margin-top: 20px;">
          Back
        </button>
      </div>

      <!-- Hazardous Waste Form Section -->
      <div id="hazardous-form-section" class="section">
        <button class="back-btn" onclick="backToHazardousMenu()">
          ‚Üê Back to Menu
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToWasteType()" id="hazardous-form-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToHazardousMenu()">Hazardous Waste</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">New Entry</span>
        </div>

        <h2 style="margin-bottom: 20px; color: #333;">New Hazardous Waste Entry</h2>

        <div class="form-group" id="hazardous-date-group">
          <label>Date</label>
          <input type="date" id="hazardous-date">
          <div class="error-msg">Please select a date</div>
        </div>

        <div class="form-group" id="hazardous-volume-group">
          <label>Volume (kg)</label>
          <input type="number" step="0.00001" id="hazardous-volume" placeholder="0.00000">
          <div class="error-msg">Please enter a volume</div>
        </div>

        <div class="form-group" id="hazardous-waste-group">
          <label>Waste Name</label>
          <select id="hazardous-waste">
            <option value="">-- Select Waste Type --</option>
            <option value="Used Oil">Used Oil</option>
            <option value="Pathological and Infectious Waste">Pathological and Infectious Waste</option>
            <option value="Lead Compounds">Lead Compounds</option>
            <option value="Oil Contaminated Materials">Oil Contaminated Materials</option>
            <option value="Grease Waste">Grease Waste</option>
            <option value="Waste Electrical and Electronic Equipment">Waste Electrical and Electronic Equipment</option>
            <option value="Mercury and Mercury Compounds">Mercury and Mercury Compounds</option>
            <option value="Containers Previously containing toxic chemical substances">Containers Previously containing toxic chemical substances</option>
          </select>
          <div class="error-msg">Please select a waste type</div>
        </div>

        <div class="form-group" id="hazardous-photo-group">
          <label>Photo Proof</label>
          <div class="photo-upload" onclick="document.getElementById('hazardous-photo').click()">
            <input type="file" id="hazardous-photo" accept="image/*" capture="environment" onchange="previewImage(event, 'hazardous')">
            <div class="placeholder">
              <div class="icon">üì∑</div>
              <p><strong>Tap to capture photo</strong></p>
              <p style="font-size: 0.85rem; color: #999; margin-top: 5px;">Required for verification</p>
            </div>
          </div>
          <div class="error-msg">Please upload a photo</div>
        </div>

        <div class="btn-group">
          <button id="hazardous-submitBtn" class="btn btn-primary" onclick="addEntry('hazardous')">
            Submit Entry
          </button>
        </div>
      </div>

      <!-- Solid Waste Form Section (NEW) -->
      <div id="solid-form-section" class="section">
        <button class="back-btn" onclick="backToSolidMenu()">
          ‚Üê Back to Menu
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToWasteType()" id="solid-form-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToSolidMenu()">Solid Waste</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">New Entry</span>
        </div>

        <h2 style="margin-bottom: 20px; color: #333;">New Solid Waste Entry</h2>

        <div class="form-group" id="solid-date-group">
          <label>Date</label>
          <input type="date" id="solid-date">
          <div class="error-msg">Please select a date</div>
        </div>

        <div class="form-group" id="solid-location-group">
          <label>Location (Pier Number)</label>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 1.1rem; font-weight: 600; color: #555;">P-</span>
            <input type="number" id="solid-location" placeholder="462" min="462" max="1260" style="flex: 1;">
          </div>
          <div class="error-msg">Please enter a pier number (462-1260)</div>
        </div>

        <div class="form-group" id="solid-waste-group">
          <label>Waste Name</label>
          <select id="solid-waste">
            <option value="">-- Select Waste Type --</option>
            <option value="Residual">Residual</option>
            <option value="Scrap">Scrap</option>
          </select>
          <div class="error-msg">Please select a waste type</div>
        </div>

        <div class="form-group" id="solid-photo-group">
          <label>Photo Proof</label>
          <div class="photo-upload" onclick="document.getElementById('solid-photo').click()">
            <input type="file" id="solid-photo" accept="image/*" capture="environment" onchange="previewImage(event, 'solid')">
            <div class="placeholder">
              <div class="icon">üì∑</div>
              <p><strong>Tap to capture photo</strong></p>
              <p style="font-size: 0.85rem; color: #999; margin-top: 5px;">Required for verification</p>
            </div>
          </div>
          <div class="error-msg">Please upload a photo</div>
        </div>

        <div class="btn-group">
          <button id="solid-submitBtn" class="btn btn-primary" onclick="addEntry('solid')">
            Submit Entry
          </button>
        </div>
      </div>

      <!-- Hazardous History Section -->
      <div id="hazardous-history-section" class="section">
        <button class="back-btn" onclick="backToHazardousMenu()">
          ‚Üê Back to Menu
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToWasteType()" id="hazardous-history-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToHazardousMenu()">Hazardous Waste</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">View Records</span>
        </div>

        <h2 style="margin-bottom: 20px; color: #333;">Hazardous Waste Records</h2>

        <div class="date-range">
          <div class="form-group">
            <label>From</label>
            <input type="date" id="hazardous-fromDate">
          </div>
          <div class="form-group">
            <label>To</label>
            <input type="date" id="hazardous-toDate">
          </div>
        </div>

        <div class="history-actions">
          <button class="btn btn-primary" onclick="loadHistory('hazardous')">
            Load Entries
          </button>
        
          <button id="hazardous-exportBtn" class="btn btn-secondary" onclick="exportExcel('hazardous')">
            Export to Excel (XLSX)
          </button>
        </div>

        <div id="hazardous-loading" style="display:none;">
          <div class="spinner"></div>
          <p style="text-align: center; color: #666;">Loading data...</p>
        </div>

        <div class="table-wrapper" id="hazardous-table-container" style="display:none;">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>kg</th>
                <th>Waste</th>
                <th>User</th>
                <th>Photo</th>
              </tr>
            </thead>
            <tbody id="hazardous-table-body"></tbody>
          </table>
        </div>

        <div id="hazardous-empty-state" class="empty-state">
          <div class="icon">üìã</div>
          <p><strong>No records to display</strong></p>
          <p style="font-size: 0.9rem;">Select a date range and click "Load Entries"</p>
        </div>
      </div>

      <!-- Solid Waste History Section (NEW) -->
      <div id="solid-history-section" class="section">
        <button class="back-btn" onclick="backToSolidMenu()">
          ‚Üê Back to Menu
        </button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToPackage()">Packages</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToWasteType()" id="solid-history-package"></span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item" onclick="backToSolidMenu()">Solid Waste</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">View Records</span>
        </div>

        <h2 style="margin-bottom: 20px; color: #333;">Solid Waste Records</h2>

        <div class="date-range">
          <div class="form-group">
            <label>From</label>
            <input type="date" id="solid-fromDate">
          </div>
          <div class="form-group">
            <label>To</label>
            <input type="date" id="solid-toDate">
          </div>
        </div>

        <div class="history-actions">
          <button class="btn btn-primary" onclick="loadHistory('solid')">
            Load Entries
          </button>
        
          <button id="solid-exportBtn" class="btn btn-secondary" onclick="exportExcel('solid')">
            Export to Excel (XLSX)
          </button>
        </div>

        <div id="solid-loading" style="display:none;">
          <div class="spinner"></div>
          <p style="text-align: center; color: #666;">Loading data...</p>
        </div>

        <div class="table-wrapper" id="solid-table-container" style="display:none;">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Location</th>
                <th>Waste</th>
                <th>User</th>
                <th>Photo</th>
              </tr>
            </thead>
            <tbody id="solid-table-body"></tbody>
          </table>
        </div>

        <div id="solid-empty-state" class="empty-state">
          <div class="icon">üìã</div>
          <p><strong>No records to display</strong></p>
          <p style="font-size: 0.9rem;">Select a date range and click "Load Entries"</p>
        </div>
      </div>
      
      <!-- Admin Dashboard -->
      <div id="admin-dashboard" class="section admin-only">
        <div class="admin-dashboard-header">
          <h2>üõ°Ô∏è Admin Dashboard</h2>
          <p>Manage users and monitor system activity</p>
        </div>

        <div class="admin-menu-grid">
          <div class="admin-menu-card" onclick="showUserManagement()">
            <div class="admin-menu-icon">üë•</div>
            <h3>User Management</h3>
            <p>Approve or reject user access</p>
            <div class="arrow">‚Üí</div>
          </div>
          
          <div class="admin-menu-card" onclick="showRequestLogs()">
            <div class="admin-menu-icon">üìù</div>
            <h3>Request Logs</h3>
            <p>View system activity logs</p>
            <div class="arrow">‚Üí</div>
          </div>
        </div>
      </div>

      <!-- User Management Section -->
      <div id="user-management-section" class="section admin-only">
        <button class="back-btn" onclick="backToAdminDashboard()">‚Üê Back to Admin Dashboard</button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToAdminDashboard()">Admin Dashboard</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">User Management</span>
        </div>

        <div class="admin-card">
          <div class="admin-header">
            <h2>üë• User Management</h2>
            <p>Approve or reject user access requests</p>
          </div>

          <div class="admin-block">
            <div class="admin-block-header">
              <h3>All Users</h3>
              <button class="btn btn-sm" onclick="loadUsers()">Refresh</button>
            </div>
            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Role</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Request Logs Section -->
      <div id="request-logs-section" class="section admin-only">
        <button class="back-btn" onclick="backToAdminDashboard()">‚Üê Back to Admin Dashboard</button>
        
        <div class="breadcrumb">
          <span class="breadcrumb-item" onclick="backToAdminDashboard()">Admin Dashboard</span>
          <span class="breadcrumb-separator">‚Ä∫</span>
          <span class="breadcrumb-item active">Request Logs</span>
        </div>

        <div class="admin-card">
          <div class="admin-header">
            <h2>üìù Request Logs</h2>
            <p>System activity and request history</p>
          </div>

          <div class="admin-block">
            <div class="admin-block-header">
              <h3>Recent Requests</h3>
              <button class="btn btn-sm" onclick="loadRequests()">Refresh</button>
            </div>

            <table class="admin-table">
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody id="requestsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
      
      
    <div class="footer">
      Created by <strong>E. Francis Albert</strong>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3>Entry Submitted!</h3>
      <p>Your waste entry has been successfully logged to the cloud.</p>
      <button class="btn btn-primary" onclick="closeModal()">OK</button>
    </div>
  </div>

  <!-- Image Preview Modal -->
  <div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <img id="modalImage" alt="Preview" onclick="event.stopPropagation()">
  </div>

  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="script.js"></script>
</body>
</html>
