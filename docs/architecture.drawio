<mxfile host="app.diagrams.net" modified="2026-02-19T00:00:00.000Z" agent="Claude" version="21.0.0" type="device">
  <diagram id="hdjv-wms-architecture" name="HDJV WMS Architecture">
    <mxGraphModel dx="1422" dy="762" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1900" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- TITLE -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <mxCell id="title" value="HDJV Waste Management System â€” Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1;fontColor=#1a1a2e;" vertex="1" parent="1">
          <mxGeometry x="550" y="20" width="800" height="40" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- ZONE LABELS -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Zone: Client -->
        <mxCell id="zone-client-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;opacity=30;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="340" height="980" as="geometry" />
        </mxCell>
        <mxCell id="zone-client-label" value="CLIENT (Browser / PWA)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=13;fontStyle=1;fontColor=#23527c;" vertex="1" parent="1">
          <mxGeometry x="40" y="75" width="340" height="30" as="geometry" />
        </mxCell>

        <!-- Zone: Backend -->
        <mxCell id="zone-backend-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="430" y="70" width="360" height="980" as="geometry" />
        </mxCell>
        <mxCell id="zone-backend-label" value="BACKEND (Google Apps Script)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=13;fontStyle=1;fontColor=#33691e;" vertex="1" parent="1">
          <mxGeometry x="430" y="75" width="360" height="30" as="geometry" />
        </mxCell>

        <!-- Zone: Storage -->
        <mxCell id="zone-storage-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="840" y="70" width="360" height="980" as="geometry" />
        </mxCell>
        <mxCell id="zone-storage-label" value="GOOGLE WORKSPACE (Storage)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=13;fontStyle=1;fontColor=#7d6608;" vertex="1" parent="1">
          <mxGeometry x="840" y="75" width="360" height="30" as="geometry" />
        </mxCell>

        <!-- Zone: Notifications -->
        <mxCell id="zone-notif-bg" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="1250" y="70" width="280" height="980" as="geometry" />
        </mxCell>
        <mxCell id="zone-notif-label" value="NOTIFICATIONS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;fontSize=13;fontStyle=1;fontColor=#a52a2a;" vertex="1" parent="1">
          <mxGeometry x="1250" y="75" width="280" height="30" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- CLIENT ZONE COMPONENTS -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Login Section -->
        <mxCell id="c-login" value="ðŸ” Login Section&#xa;(index.html)&#xa;&#xa;â€¢ Enter email&#xa;â€¢ Google Sign-In button&#xa;â€¢ Status messages" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="120" width="300" height="110" as="geometry" />
        </mxCell>

        <!-- Auth / Session Manager -->
        <mxCell id="c-session" value="ðŸ”‘ Session Manager&#xa;(script.js)&#xa;&#xa;â€¢ localStorage: token, role, email, tokenExpiry&#xa;â€¢ Token refresh timer (30 min before expiry)&#xa;â€¢ validateSession() on every load&#xa;â€¢ handleSessionExpired() â†’ clear &amp; redirect" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="250" width="300" height="130" as="geometry" />
        </mxCell>

        <!-- Package / Waste Type Selection -->
        <mxCell id="c-select" value="ðŸ“¦ Package &amp; Waste Type Selection&#xa;&#xa;â€¢ P4 / P5 / P6 card selection&#xa;â€¢ Hazardous â˜£ï¸ / Solid ðŸ—‘ï¸ toggle&#xa;â€¢ Breadcrumb navigation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="400" width="300" height="110" as="geometry" />
        </mxCell>

        <!-- Waste Log Form -->
        <mxCell id="c-form" value="ðŸ“ Waste Log Form&#xa;&#xa;Hazardous: date, volume (L), waste name, photo&#xa;Solid: date, dump location, waste name, photo&#xa;&#xa;â€¢ Canvas watermark on photo (email + pkg + time)&#xa;â€¢ Fingerprint dedup check before POST&#xa;â€¢ Submit â†’ POST to Apps Script" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="530" width="300" height="130" as="geometry" />
        </mxCell>

        <!-- History View -->
        <mxCell id="c-history" value="ðŸ“‹ History &amp; Export&#xa;&#xa;â€¢ Date range filter (from / to)&#xa;â€¢ Fetch records from Apps Script&#xa;â€¢ Render table with photo preview modal&#xa;â€¢ Export to Excel (.xlsx) via SheetJS&#xa;â€¢ Export to PDF via jsPDF" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="680" width="300" height="130" as="geometry" />
        </mxCell>

        <!-- Admin Dashboard -->
        <mxCell id="c-admin" value="ðŸ›¡ï¸ Admin Dashboard (Admin+ only)&#xa;&#xa;â€¢ User Management: approve / reject / role / delete&#xa;â€¢ Analytics: KPIs, trend chart, breakdown,&#xa;  contributors, PDF export&#xa;â€¢ Request Logs&#xa;â€¢ Push notification bell + badge" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="830" width="300" height="130" as="geometry" />
        </mxCell>

        <!-- Service Worker -->
        <mxCell id="c-sw" value="âš™ï¸ Service Worker (sw.js)&#xa;&#xa;â€¢ Receives push events&#xa;â€¢ Shows system notifications&#xa;â€¢ Handles notification click actions&#xa;â€¢ Background sync hook" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0e6ff;strokeColor=#7b4f9e;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="60" y="980" width="300" height="110" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- BACKEND ZONE COMPONENTS -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Router -->
        <mxCell id="b-router" value="ðŸ”€ Request Router&#xa;(doGet / doPost)&#xa;&#xa;Dispatches by action= parameter:&#xa;â€¢ No action + email â†’ login&#xa;â€¢ validateToken / refreshToken / logout&#xa;â€¢ getUsers / approveUser / rejectUser&#xa;â€¢ updateUserStatus / updateUserRole / deleteUser&#xa;â€¢ getRequests / checkUserSheet&#xa;â€¢ getImageBase64&#xa;â€¢ package= â†’ fetch records&#xa;â€¢ POST body â†’ log waste entry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="450" y="120" width="320" height="210" as="geometry" />
        </mxCell>

        <!-- Auth Module -->
        <mxCell id="b-auth" value="ðŸ” Auth Module&#xa;&#xa;checkUser(email)&#xa;  â†’ lookup or register user&#xa;  â†’ issue UUID token + 7-day expiry&#xa;&#xa;validateUserToken(token)&#xa;  â†’ match token, check expiry&#xa;&#xa;refreshToken(oldToken)&#xa;  â†’ extend expiry 7 more days&#xa;&#xa;requireAdmin(token)&#xa;  â†’ role must be admin/super_admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="450" y="350" width="320" height="190" as="geometry" />
        </mxCell>

        <!-- Rate Limiter -->
        <mxCell id="b-ratelimit" value="â±ï¸ Rate Limiter&#xa;&#xa;checkRateLimit(email)&#xa;  â†’ RateLimits sheet lookup&#xa;  â†’ 100 req / hour per user&#xa;  â†’ reset after 1-hour window&#xa;  â†’ returns true/false" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="450" y="560" width="320" height="130" as="geometry" />
        </mxCell>

        <!-- User Manager -->
        <mxCell id="b-usermgr" value="ðŸ‘¥ User Manager (Admin+)&#xa;&#xa;getUsersSecure(token)&#xa;updateUserStatusSecure(token, email, status)&#xa;updateUserRoleSecure(token, email, role)&#xa;deleteUserSecure(token, email)&#xa;&#xa;Super Admin only: role changes, deletes&#xa;Admin: approve/reject pending only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="450" y="710" width="320" height="150" as="geometry" />
        </mxCell>

        <!-- Data Layer -->
        <mxCell id="b-data" value="ðŸ“Š Data Layer&#xa;&#xa;fetchEntries(pkg, user, from, to, wasteType)&#xa;  â†’ selects PACKAGE_MAP or SOLID_PACKAGE_MAP&#xa;  â†’ opens correct sheet&#xa;  â†’ filters by package + date range&#xa;  â†’ returns [headers, ...rows]&#xa;&#xa;doPost â†’ validates fields â†’ uploads photo&#xa;  â†’ appends row with timestamp" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;spacingLeft=10;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="450" y="880" width="320" height="170" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- STORAGE ZONE COMPONENTS -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Users Sheet -->
        <mxCell id="s-users" value="ðŸ“„ Google Sheet: Users&#xa;(USER_SHEET_ID)&#xa;&#xa;Cols: Email | Status | Token |&#xa;Last Login | Role | Token Expiry&#xa;&#xa;Status: Pending / Approved / Rejected&#xa;Role: user / admin / super_admin" style="shape=mxgraph.flowchart.document;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="860" y="120" width="300" height="140" as="geometry" />
        </mxCell>

        <!-- RateLimits Sheet -->
        <mxCell id="s-ratelimit" value="ðŸ“„ Google Sheet: RateLimits&#xa;&#xa;Cols: Email | Count | Window Start&#xa;&#xa;Resets per 1-hour sliding window&#xa;Max: 100 requests / hour" style="shape=mxgraph.flowchart.document;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="860" y="280" width="300" height="120" as="geometry" />
        </mxCell>

        <!-- Requests Sheet -->
        <mxCell id="s-requests" value="ðŸ“„ Google Sheet: Requests&#xa;(Idempotency Log)&#xa;&#xa;Cols: requestId | timestamp&#xa;&#xa;Prevents duplicate POST submissions&#xa;requestId = fingerprint + date" style="shape=mxgraph.flowchart.document;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="860" y="420" width="300" height="130" as="geometry" />
        </mxCell>

        <!-- Access Log Sheet -->
        <mxCell id="s-accesslog" value="ðŸ“„ Google Sheet: Access_Log&#xa;(Audit Trail)&#xa;&#xa;Cols: Timestamp | Action | Email |&#xa;Success | IP&#xa;&#xa;Every API call is logged here" style="shape=mxgraph.flowchart.document;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="860" y="570" width="300" height="130" as="geometry" />
        </mxCell>

        <!-- Waste Sheets Hazardous -->
        <mxCell id="s-hazsheets" value="ðŸ“„ Google Sheets: Hazardous Waste&#xa;(PACKAGE_MAP)&#xa;&#xa;P4: separate sheet + Drive folder&#xa;P5: separate sheet + Drive folder&#xa;P6: separate sheet + Drive folder&#xa;&#xa;Cols: date | volume | waste name |&#xa;package | logged by | photo | timestamp" style="shape=mxgraph.flowchart.document;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="860" y="720" width="300" height="170" as="geometry" />
        </mxCell>

        <!-- Waste Sheets Solid -->
        <mxCell id="s-solidsheets" value="ðŸ“„ Google Sheets: Solid Waste&#xa;(SOLID_PACKAGE_MAP)&#xa;&#xa;P4: separate sheet + Drive folder&#xa;P5: separate sheet + Drive folder&#xa;P6: separate sheet + Drive folder&#xa;&#xa;Cols: date | location | waste name |&#xa;package | logged by | photo | timestamp" style="shape=mxgraph.flowchart.document;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="860" y="910" width="300" height="170" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- NOTIFICATIONS ZONE -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Gmail -->
        <mxCell id="n-gmail" value="ðŸ“§ Gmail / MailApp&#xa;&#xa;sendStatusNotification()&#xa;  â†’ Approval email to user&#xa;  â†’ Rejection email to user&#xa;&#xa;notifySuperAdminsOfNewUser()&#xa;  â†’ Alert all super_admins&#xa;    on new registration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="1270" y="120" width="240" height="180" as="geometry" />
        </mxCell>

        <!-- Push Notifications -->
        <mxCell id="n-push" value="ðŸ”” Push Notifications&#xa;(Browser / Service Worker)&#xa;&#xa;â€¢ Admin enables permission&#xa;â€¢ Poll every 2 min for pending users&#xa;â€¢ count increased â†’ showNotification()&#xa;â€¢ Actions: [Review Now] [Later]&#xa;â€¢ Click â†’ navigate to User Mgmt" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="1270" y="320" width="240" height="180" as="geometry" />
        </mxCell>

        <!-- Drive -->
        <mxCell id="n-drive" value="ðŸ“ Google Drive&#xa;(Photo Storage)&#xa;&#xa;Per-package folders:&#xa;â€¢ Hazardous P4 / P5 / P6&#xa;â€¢ Solid P4 / P5 / P6&#xa;&#xa;Files: JPEG with canvas watermark&#xa;Access: via getImageBase64()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="1270" y="520" width="240" height="180" as="geometry" />
        </mxCell>

        <!-- External Libraries -->
        <mxCell id="n-libs" value="ðŸ“¦ External Libraries (CDN)&#xa;&#xa;â€¢ Chart.js â€” analytics charts&#xa;â€¢ jsPDF â€” PDF export&#xa;â€¢ SheetJS (xlsx) â€” Excel export&#xa;â€¢ Canvas API (built-in) â€” watermark" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e6d0de;strokeColor=#ae4132;fontSize=11;align=left;spacingLeft=8;verticalAlign=top;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="1270" y="720" width="240" height="150" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- ARROWS: Client â†’ Backend -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Login â†’ Router -->
        <mxCell id="e1" value="GET ?email=" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#6c8ebf;fontColor=#23527c;fontSize=10;" edge="1" source="c-login" target="b-router" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Session â†’ Router (validate/refresh/logout) -->
        <mxCell id="e2" value="GET ?action=validateToken&#xa;refreshToken / logout" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#6c8ebf;fontColor=#23527c;fontSize=10;" edge="1" source="c-session" target="b-router" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Waste Form â†’ Router (POST) -->
        <mxCell id="e3" value="POST {token, package,&#xa;wasteType, fields, imageByte}" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#6c8ebf;fontColor=#23527c;fontSize=10;" edge="1" source="c-form" target="b-router" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- History â†’ Router (fetch records) -->
        <mxCell id="e4" value="GET ?package=&amp;wasteType=&#xa;&amp;from=&amp;to=" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#6c8ebf;fontColor=#23527c;fontSize=10;" edge="1" source="c-history" target="b-router" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Admin â†’ Router -->
        <mxCell id="e5" value="GET ?action=getUsers&#xa;approveUser / deleteUser etc." style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#9673a6;fontColor=#9673a6;fontSize=10;" edge="1" source="c-admin" target="b-router" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- ARROWS: Backend internal -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Router â†’ Auth -->
        <mxCell id="e6" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#82b366;fontSize=10;" edge="1" source="b-router" target="b-auth" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Router â†’ RateLimit -->
        <mxCell id="e7" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#82b366;fontSize=10;" edge="1" source="b-router" target="b-ratelimit" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Router â†’ UserMgr -->
        <mxCell id="e8" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#82b366;fontSize=10;" edge="1" source="b-router" target="b-usermgr" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Router â†’ Data -->
        <mxCell id="e9" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#82b366;fontSize=10;" edge="1" source="b-router" target="b-data" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- ARROWS: Backend â†’ Storage -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

        <!-- Auth â†’ Users Sheet -->
        <mxCell id="e10" value="R/W token, status, role" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d6b656;fontColor=#7d6608;fontSize=10;" edge="1" source="b-auth" target="s-users" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- RateLimit â†’ RateLimits Sheet -->
        <mxCell id="e11" value="R/W counts" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d6b656;fontColor=#7d6608;fontSize=10;" edge="1" source="b-ratelimit" target="s-ratelimit" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Data â†’ Requests Sheet -->
        <mxCell id="e12" value="Check / log requestId" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d6b656;fontColor=#7d6608;fontSize=10;" edge="1" source="b-data" target="s-requests" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Router â†’ Access Log -->
        <mxCell id="e13" value="logRequest() every call" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d6b656;fontColor=#7d6608;fontSize=10;" edge="1" source="b-router" target="s-accesslog" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Data â†’ Hazardous Sheets -->
        <mxCell id="e14" value="R/W waste rows" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d79b00;fontColor=#7d4f00;fontSize=10;" edge="1" source="b-data" target="s-hazsheets" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Data â†’ Solid Sheets -->
        <mxCell id="e15" value="R/W waste rows" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d79b00;fontColor=#7d4f00;fontSize=10;" edge="1" source="b-data" target="s-solidsheets" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Data â†’ Drive -->
        <mxCell id="e16" value="createFile(blob)" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#d79b00;fontColor=#7d4f00;fontSize=10;" edge="1" source="b-data" target="n-drive" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- UserMgr â†’ Gmail -->
        <mxCell id="e17" value="MailApp.sendEmail()" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#b85450;fontColor=#a52a2a;fontSize=10;" edge="1" source="b-usermgr" target="n-gmail" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Auth â†’ Gmail (new user notify) -->
        <mxCell id="e18" value="notifySuperAdmins()" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#b85450;fontColor=#a52a2a;fontSize=10;" edge="1" source="b-auth" target="n-gmail" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Admin â†’ Push Notif -->
        <mxCell id="e19" value="Poll + SW.showNotification()" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#b85450;fontColor=#a52a2a;fontSize=10;" edge="1" source="c-admin" target="n-push" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- SW â†” Admin Dashboard -->
        <mxCell id="e20" value="postMessage(NAVIGATE_TO_ADMIN)" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#9673a6;fontColor=#6b3d8c;fontSize=10;dashed=1;" edge="1" source="c-sw" target="c-admin" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Admin â†’ Libraries -->
        <mxCell id="e21" value="Chart.js / jsPDF / SheetJS" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#ae4132;fontColor=#ae4132;fontSize=10;dashed=1;" edge="1" source="c-admin" target="n-libs" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- History â†’ Libraries -->
        <mxCell id="e22" value="SheetJS export" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeColor=#ae4132;fontColor=#ae4132;fontSize=10;dashed=1;" edge="1" source="c-history" target="n-libs" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
